<div class="container mt-5">
    <h2>Pending Reservations</h2>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>User</th>
                <th>Vehicle type</th>
                <th>License</th>
                <th>Spaces</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let reservation of pendingReservations">
                <td>{{ reservation.reservation_id }}</td>
                <td>{{ reservation.users_model?.username }}</td>
                <td>{{ reservation.vehicles_model?.vehicle_type }}</td>
                <td>{{ reservation.vehicles_model?.license_plate }}</td>
                <td>{{ reservation.parking_spaces_model?.space_number }}</td>
                <td>{{ reservation.reservation_start | date:'short' }}</td>
                <td>{{ reservation.reservation_end | date:'short' }}</td>
                <td>{{ reservation.status }}</td>
                <td>
                    <i class="bi bi-pencil-square text-primary me-3 icon-hover" (click)="openEditModal(reservation)"
                        title="Editar"></i>
                    <i class="bi bi-eye text-success icon-hover" (click)="openViewModal(reservation)"
                        title="Ver detalles"></i>
                </td>
            </tr>
        </tbody>
    </table>

    <h2>Completed Reservations</h2>
    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>User</th>
                <th>Vehicle type</th>
                <th>License</th>
                <th>Spaces</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Status</th>
                <th>Fee</th> <!-- Nueva columna para mostrar la tarifa -->
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let reservation of completedReservations">
                <td>{{ reservation.reservation_id }}</td>
                <td>{{ reservation.users_model?.username }}</td>
                <td>{{ reservation.vehicles_model?.vehicle_type }}</td>
                <td>{{ reservation.vehicles_model?.license_plate }}</td>
                <td>{{ reservation.parking_spaces_model?.space_number }}</td>
                <td>{{ reservation.reservation_start | date:'short' }}</td>
                <td>{{ reservation.reservation_end | date:'short' }}</td>
                <td>{{ reservation.status }}</td>
                <td>${{ reservation.fee || 0 }} </td> <!-- Mostrar la tarifa calculada -->
                <td>
                    <i class="bi bi-pencil-square text-primary me-3 icon-hover" (click)="openEditModal(reservation)"
                        title="Editar"></i>
                    <i class="bi bi-eye text-success icon-hover" (click)="openViewModal(reservation)"
                        title="Ver detalles"></i>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Modal para ver detalles de la reserva -->
    <div class="modal fade" id="viewReservationModal" tabindex="-1" aria-labelledby="viewReservationModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="viewReservationModalLabel">
                        Reservation Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row mb-3">
                            <div class="col-4 text-end text-uppercase text-muted fw-bold">
                                Reservation ID:
                            </div>
                            <div class="col-8 text-dark">{{ selectedReservation?.reservation_id }}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4 text-end text-uppercase text-muted fw-bold">
                                User:
                            </div>
                            <div class="col-8 text-dark">{{ selectedReservation?.users_model?.username }}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4 text-end text-uppercase text-muted fw-bold">
                                Space:
                            </div>
                            <div class="col-8 text-dark">{{ selectedReservation?.parking_spaces_model?.space_number }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4 text-end text-uppercase text-muted fw-bold">
                                Vehicle:
                            </div>
                            <div class="col-8 text-dark">{{ selectedReservation?.vehicles_model?.license_plate }} - {{
                                selectedReservation?.vehicles_model?.vehicle_type }}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4 text-end text-uppercase text-muted fw-bold">
                                Start Time:
                            </div>
                            <div class="col-8 text-dark">{{ selectedReservation?.reservation_start | date:'short' }}
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4 text-end text-uppercase text-muted fw-bold">
                                End Time:
                            </div>
                            <div class="col-8 text-dark">{{ selectedReservation?.reservation_end | date:'short' }}</div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-4 text-end text-uppercase text-muted fw-bold">
                                Status:
                            </div>
                            <div class="col-8">
                                <span class="badge bg-warning text-dark px-3 py-2 rounded-pill">{{
                                    selectedReservation?.status }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal para editar reservas -->
    <div class="modal fade" id="editReservationModal" tabindex="-1" aria-labelledby="editReservationModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg"> <!-- Ampliamos el modal -->
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="editReservationModalLabel">
                        <i class="bi bi-pencil-square me-2"></i> Edit Reservation
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="user_id" class="form-label fw-bold text-uppercase text-muted">User</label>
                                <input type="text" class="form-control" id="user_id"
                                    [value]="selectedReservation?.user_id" readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="space_id" class="form-label fw-bold text-uppercase text-muted">Space</label>
                                <input type="text" class="form-control" id="space_id"
                                    [value]="selectedReservation?.space_id" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="vehicle_id"
                                    class="form-label fw-bold text-uppercase text-muted">Vehicle</label>
                                <input type="text" class="form-control" id="vehicle_id"
                                    [value]="selectedReservation?.vehicle_id" readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="reservation_end" class="form-label fw-bold text-uppercase text-muted">End
                                    Time</label>
                                <input type="datetime-local" class="form-control" id="reservation_end"
                                    [(ngModel)]="selectedReservation.reservation_end" name="reservation_end" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="status" class="form-label fw-bold text-uppercase text-muted">Status</label>
                            <select class="form-select" [(ngModel)]="selectedReservation.status" name="status">
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="canceled">Canceled</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i> Close
                    </button>
                    <button type="button" class="btn btn-primary" (click)="updateReservation()">
                        <i class="bi bi-save me-1"></i> Save changes
                    </button>
                </div>
            </div>
        </div>
    </div>